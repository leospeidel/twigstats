[{"path":"https://leospeidel.com/twigstats/LICENSE.html","id":null,"dir":"","previous_headings":"","what":"MIT License","title":"MIT License","text":"Copyright (c) 2023 twigstats authors Permission hereby granted, free charge, person obtaining copy software associated documentation files (“Software”), deal Software without restriction, including without limitation rights use, copy, modify, merge, publish, distribute, sublicense, /sell copies Software, permit persons Software furnished , subject following conditions: copyright notice permission notice shall included copies substantial portions Software. SOFTWARE PROVIDED “”, WITHOUT WARRANTY KIND, EXPRESS IMPLIED, INCLUDING LIMITED WARRANTIES MERCHANTABILITY, FITNESS PARTICULAR PURPOSE NONINFRINGEMENT. EVENT SHALL AUTHORS COPYRIGHT HOLDERS LIABLE CLAIM, DAMAGES LIABILITY, WHETHER ACTION CONTRACT, TORT OTHERWISE, ARISING , CONNECTION SOFTWARE USE DEALINGS SOFTWARE.","code":""},{"path":"https://leospeidel.com/twigstats/articles/basic-usage.html","id":"computing-f2-statistics-from-relate-genealogies","dir":"Articles","previous_headings":"","what":"Computing f2-statistics from Relate genealogies","title":"Basic usage","text":"first use-case compute f2-statistics Relate genealogies (https://myersgroup.github.io/relate/). central function called f2_blocks_from_Relate() takes Relate output files input. Please type ?f2_blocks_from_Relate details: illustrate basic Twigstats run using example files included Twigstats package. example, population PX admixed populations P2 P3, mixture proportion 80% 20%, respectively. first calculate f2 statistics normal mutations. plug f2 statistics f4-ratio statistic computes estimate admixture proportion. can see, inferred admixture proportion close true value 80% standard errors large. shows underpowered infer admixture proportions using f4-ratio statistic. Now specify twigstats cutoff 500 generations plug f4-ratio statistic: standard errors much reduced! Use argument use_muts compute f2-statistics (age-ascertained) mutations, instead branch lengths Relate genealogies. Use argument blgsize change jackknife block size Set argument transitions False exclude transitions","code":"#These lines assign file names to variables file_anc, file_mut, poplabels, file_map. #see https://myersgroup.github.io/relate/getting_started.html#Output for file formats file_anc  <- system.file(\"sim/msprime_ad0.8_split250_1_chr1.anc.gz\", package = \"twigstats\") file_mut  <- system.file(\"sim/msprime_ad0.8_split250_1_chr1.mut.gz\", package = \"twigstats\") #see https://myersgroup.github.io/relate/input_data.html for file formats poplabels <- system.file(\"sim/msprime_ad0.8_split250_1.poplabels\", package = \"twigstats\") file_map  <- system.file(\"sim/genetic_map_combined_b37_chr1.txt\", package = \"twigstats\") #recombination map (three column format) #Calculate regular f2s between all pairs of populations f2_blocks1 <- f2_blocks_from_Relate(file_anc, file_mut, poplabels, file_map) f4_ratio(f2_blocks1, popX=\"PX\", popI=\"P1\", pop1=\"P2\", pop2=\"P3\", popO=\"P4\") #>   popO popI pop1 pop2 popX       val        se #> 1   P4   P1   P2   P3   PX 0.9974217 0.3076228 #Now calculate f2s using a twigstats cutoff of 500 generations.  #This should give us a big power boost. f2_blocks2 <- f2_blocks_from_Relate(file_anc, file_mut, poplabels, file_map, t = 500) f4_ratio(f2_blocks2, popX=\"PX\", popI=\"P1\", pop1=\"P2\", pop2=\"P3\", popO=\"P4\") #>   popO popI pop1 pop2 popX       val         se #> 1   P4   P1   P2   P3   PX 0.8110266 0.02085804"},{"path":"https://leospeidel.com/twigstats/articles/basic-usage.html","id":"using-admixtools2","dir":"Articles","previous_headings":"Computing f2-statistics from Relate genealogies","what":"Using admixtools2","title":"Basic usage","text":"can now directly feed admixtools2 functions:","code":"library(admixtools) #no twigstats ascertainment f4(f2_blocks1, \"P4\", \"P3\", \"P2\", \"PX\") #> # A tibble: 1 × 8 #>   pop1  pop2  pop3  pop4      est       se     z         p #>   <chr> <chr> <chr> <chr>   <dbl>    <dbl> <dbl>     <dbl> #> 1 P4    P3    P2    PX    0.00127 0.000314  4.04 0.0000543 #with twigstats ascertainment f4(f2_blocks2, \"P4\", \"P3\", \"P2\", \"PX\") #> # A tibble: 1 × 8 #>   pop1  pop2  pop3  pop4       est        se     z         p #>   <chr> <chr> <chr> <chr>    <dbl>     <dbl> <dbl>     <dbl> #> 1 P4    P3    P2    PX    0.000635 0.0000253  25.1 1.37e-138"},{"path":"https://leospeidel.com/twigstats/articles/basic-usage.html","id":"computing-f2-statistics-on-age-ascertained-snps","dir":"Articles","previous_headings":"","what":"Computing f2-statistics on age-ascertained SNPs","title":"Basic usage","text":"Sometimes, prefer graft samples genealogies (e.g. due low sequencing coverage, don’t trust imputation).  Therefore, second use-case Twigstats compute f2-statistics age ascertained mutations. central function called f2_blocks_from_RelateAges() takes plink (bed/bim/fam) files mutation ages (.mut) input. Please type ?f2_blocks_from_RelateAges details: begin assigning filenames following variables. case, files stored path prefix pref. Next, compute f2-statistics normal plink format plug f4-ratio statistic estimate admixture proportion. , can see standard error inferred dmixture proportion large. shows lacking power using standard f-statistics approach. can now ascertain mutations age. choose cutoff 500 generations: standard errors much reduced! unable get reliable estimate without twigstats ascertainment, estimate PX carry approximately 80% P2 20% P3 ancestry twigstats. Use argument pops analyse subset populations fam change population assignment individuals Use argument blgsize change jackknife block size Set argument transitions False exclude transitions Use file_mut = “./1240k/1240k” calculate f2 statistics 1240k sites Use file_mut = “./1000G_ages/1000GP_Phase3_mask_prene_nosingle_chr1” calculate f2 statistics 1240k sites","code":"path <- paste0(system.file(\"sim/\", package = \"twigstats\"),\"/\") pref <- \"msprime_ad0.8_split250_1\" file_plink <- paste0(path,pref) #only need prefix file_mut  <- paste0(path,pref) #only need prefix (here same name as plink file but can be different) #Compute regular f2 statistics between all pairs of populations. You can use pops to only calculate f2s between specified populations. f2_blocks1 <- f2_blocks_from_RelateAges(pref = file_plink, file_mut) f4_ratio(f2_blocks1, popX=\"PX\", popI=\"P1\", pop1=\"P2\", pop2=\"P3\", popO=\"P4\") #>   popO popI pop1 pop2 popX      val        se #> 1   P4   P1   P2   P3   PX 1.082681 0.2931867 #Use a cutoff of 500 generations f2_blocks2 <- f2_blocks_from_RelateAges(pref = file_plink, file_mut, t = 500) f4_ratio(f2_blocks2, popX=\"PX\", popI=\"P1\", pop1=\"P2\", pop2=\"P3\", popO=\"P4\") #>   popO popI pop1 pop2 popX      val         se #> 1   P4   P1   P2   P3   PX 0.810077 0.03097378"},{"path":"https://leospeidel.com/twigstats/articles/basic-usage.html","id":"using-admixtools2-1","dir":"Articles","previous_headings":"Computing f2-statistics on age-ascertained SNPs","what":"Using admixtools2","title":"Basic usage","text":"can now directly feed admixtools2 functions:","code":"library(admixtools) #no twigstats ascertainment f4(f2_blocks1, \"P4\", \"P3\", \"P2\", \"PX\") #> # A tibble: 1 × 8 #>   pop1  pop2  pop3  pop4      est       se     z        p #>   <chr> <chr> <chr> <chr>   <dbl>    <dbl> <dbl>    <dbl> #> 1 P4    P3    P2    PX    0.00116 0.000305  3.81 0.000139 #with twigstats ascertainment f4(f2_blocks2, \"P4\", \"P3\", \"P2\", \"PX\") #> # A tibble: 1 × 8 #>   pop1  pop2  pop3  pop4       est        se     z         p #>   <chr> <chr> <chr> <chr>    <dbl>     <dbl> <dbl>     <dbl> #> 1 P4    P3    P2    PX    0.000642 0.0000281  22.9 9.35e-116"},{"path":"https://leospeidel.com/twigstats/articles/real-data-example.html","id":"preparing-the-data","dir":"Articles","previous_headings":"","what":"Preparing the data","title":"A small real data example","text":"imputed ancient genomes GLIMPSE (https://odelaneau.github.io/GLIMPSE/) using 1000 Genomes Project reference panel. merged imputed genomes subset 1000 Genomes Project dataset. samples use Given merged VCF, remove SNPs missing data, filter data imputation quality (e.g. requiring minimum imputation posterior minimum INFO score). Removing SNPs genotype imputation posterior <80% achieved running something like following command usually works well small number samples. larger data sets, likely restrictive. Please note Relate accept missing data input, like e.g. retain sites <2% genotypes posterior <80%, need first generate list BP positions SNPs keep, subset original imputed vcf using bcftools. list can generated e.g. alternatively use bcftools annotate SNP INFO score (see impute-info plugin bcftools) require minimum INFO score SNP. score measures well SNP imputed using surrounding haplotype information. may also opt analyse transversions, can extract using following command VCF containing SNPs happy , can now use script provided Relate package convert Relate input format. details please consult Relate documentation: , used human ancestral genome mappability mask. files avaliable GRCh38 well: human ancestral genome mappability mask.","code":"popl <- read.table(system.file(\"example/1000GP_Phase3_sub_aDNA.poplabels\", package = \"twigstats\"), header = T) print(popl) #>         ID                              POP   GROUP    SEX #> 1  NA12249                              CEU     EUR female #> 2  NA12830                              CEU     EUR female #> 3  NA07048                              CEU     EUR   male #> 4  NA12815                              CEU     EUR female #> 5  NA06986                              CEU     EUR   male #> 6  NA18635                              CHB     EAS   male #> 7  NA18609                              CHB     EAS   male #> 8  NA18593                              CHB     EAS female #> 9  NA18546                              CHB     EAS   male #> 10 NA18595                              CHB     EAS female #> 11 HG00233                              GBR     EUR female #> 12 HG00151                              GBR     EUR   male #> 13 HG00118                              GBR     EUR female #> 14 HG00160                              GBR     EUR   male #> 15 HG00140                              GBR     EUR   male #> 16 NA18907                              YRI     AFR female #> 17 NA19257                              YRI     AFR female #> 18 NA18504                              YRI     AFR   male #> 19 NA18498                              YRI     AFR   male #> 20 NA19131                              YRI     AFR female #> 21   3DT16             Britain.IronRoman.SG      UK      M #> 22   6DT18             Britain.IronRoman.SG      UK      M #> 23   6DT21             Britain.IronRoman.SG      UK      M #> 24   6DT22             Britain.IronRoman.SG      UK      M #> 25   6DT23             Britain.IronRoman.SG      UK      M #> 26  C10427             Britain.IronRoman.SG      UK      U #> 27   I0156             Britain.IronRoman.SG      UK      M #> 28   I0160             Britain.IronRoman.SG      UK      M #> 29   I0789             Britain.IronRoman.SG      UK      F #> 30   M1489             Britain.IronRoman.SG      UK      F #> 31  HAD001                 England_Saxon.SG      UK      M #> 32  HAD013                 England_Saxon.SG      UK      F #> 33   I0161                 England_Saxon.SG      UK      F #> 34   I0774                 England_Saxon.SG      UK      F #> 35   I0777                 England_Saxon.SG      UK      F #> 36  OAI004                 England_Saxon.SG      UK      F #> 37  OAI007                 England_Saxon.SG      UK      F #> 38   rath1                    Ireland_BA.SG Ireland      M #> 39   rath2                    Ireland_BA.SG Ireland      M #> 40   rath3                    Ireland_BA.SG Ireland      M #> 41  als001 Scandinavian_Peninsula_EIA(I).SG  Sweden      M #> 42  lov001 Scandinavian_Peninsula_EIA(I).SG  Sweden      F #> 43  snb010 Scandinavian_Peninsula_EIA(I).SG  Sweden      M #> 44  snb013 Scandinavian_Peninsula_EIA(I).SG  Sweden      M #> 45  snb014 Scandinavian_Peninsula_EIA(I).SG  Sweden      M bcftools view --max-alleles 2 --exclude-types indels 1000G_aDNA_chr1.vcf.gz |  bcftools +setGT -- -t q -n . -i'SMPL_MAX(FORMAT/GP)<=0.8' |  bcftools view -i 'F_MISSING==0.0' -O z -o 1000G_aDNA_nomiss_chr1.vcf.gz bcftools view --max-alleles 2 --exclude-types indels 1000G_aDNA_chr1.vcf.gz |  bcftools +setGT -- -t q -n . -i'SMPL_MAX(FORMAT/GP)<=0.8' |  bcftools view -i 'F_MISSING<=0.02' |  bcftools query -f \"%CHROM %BP\\n\" > BP_chr1.txt bcftools view -i 'TYPE=\"snp\" && ( (REF!=\"A\" || ALT!=\"G\") && (REF!=\"G\" || ALT!=\"A\") && (REF!=\"C\" || ALT!=\"T\") && (REF!=\"T\" || ALT!=\"C\"))' 1000G_aDNA_nomiss_chr1.vcf.gz -O z -o 1000G_aDNA_transv_chr1.vcf.gz ~/Documents/genomics/software/relate/bin/RelateFileFormats \\     --mode ConvertFromVcf \\   -i 1000G_aDNA_transv_chr1 \\     --haps 1000G_aDNA_transv_chr1.haps \\     --sample 1000G_aDNA_transv_chr1.sample  gzip -f 1000G_aDNA_transv_chr1.haps gzip -f 1000G_aDNA_transv_chr1.sample  ~/Documents/genomics/software/relate/scripts/PrepareInputFiles/PrepareInputFiles.sh \\     --haps 1000G_aDNA_transv_chr1.haps.gz \\     --sample 1000G_aDNA_transv_chr1.sample.gz \\     --ancestor human_ancestor_chr1.fa.gz \\     -o 1000G_aDNA_mask_transv_chr1 \\     --remove_ids remove.txt \\     --mask ./StrictMask_chr1.fa.gz"},{"path":"https://leospeidel.com/twigstats/articles/real-data-example.html","id":"running-relate","dir":"Articles","previous_headings":"","what":"Running Relate","title":"A small real data example","text":"prepared data, can now run Relate. Please consult Relate documentation details run Relate. , run Relate using mutation rate 4e-9, corresponding approximately average transversion mutation rate humans, use pre-inferred coalescence rates stored 1000G_auto.coal.","code":"path=\"/opt/homebrew/lib/R/4.3/site-library/twigstats/example/\"  Relate --mode All \\     --haps ${path}/1000G_aDNA_mask_transv_chr1.haps.gz \\     --sample ${path}/1000G_aDNA_mask_transv_chr1.sample.gz \\     --dist ${path}/1000G_aDNA_mask_transv_chr1.dist.gz \\     --map ${path}/genetic_map_combined_b37_chr1.txt \\     -o 1000G_aDNA_mask_transv_chr1 \\     -m 4e-9 \\     --coal ${path}/1000G_auto.coal \\     --sample_ages ${path}/sample_ages.txt \\     --memory 5 \\     --seed 1  gzip -f 1000G_aDNA_mask_transv_chr1.anc gzip -f 1000G_aDNA_mask_transv_chr1.mut #>  #> ********************************************************* #> --------------------------------------------------------- #> Relate #>  * Authors: Leo Speidel, Marie Forest, Sinan Shi, Simon Myers. #>  * Doc:     https://myersgroup.github.io/relate #> --------------------------------------------------------- #>  #> --------------------------------------------------------- #> Using: #>   /opt/homebrew/lib/R/4.3/site-library/twigstats/example//1000G_aDNA_mask_transv_chr1.haps.gz #>   /opt/homebrew/lib/R/4.3/site-library/twigstats/example//1000G_aDNA_mask_transv_chr1.sample.gz #>   /opt/homebrew/lib/R/4.3/site-library/twigstats/example//genetic_map_combined_b37_chr1.txt #> with mu = 4e-09 and coal = /opt/homebrew/lib/R/4.3/site-library/twigstats/example//1000G_auto.coal. #> --------------------------------------------------------- #>  #> --------------------------------------------------------- #> Parsing data.. #> Warning: Will use min 0.00019GB of hard disc. #> CPU Time spent: 2.784538s; Max Memory usage: 56Mb. #> --------------------------------------------------------- #>  #> --------------------------------------------------------- #> Read 90 haplotypes with 229231 SNPs per haplotype. #> Expected minimum memory usage: 1.5Gb. #> --------------------------------------------------------- #>  #> --------------------------------------------------------- #> Starting chunk 0 of 0. #> --------------------------------------------------------- #>  #> --------------------------------------------------------- #> Painting sequences... #> CPU Time spent: 3.977966s; Max Memory usage: 1e+02Mb. #> --------------------------------------------------------- #>  #> --------------------------------------------------------- #> Estimating topologies of AncesTrees in sections 0-0... #> [0/0] CPU Time spent: 15.727941s; Max Memory usage: 1.6e+03Mb. #> --------------------------------------------------------- #>  #> --------------------------------------------------------- #> Propagating mutations across AncesTrees... #> CPU Time spent: 19.231844s; Max Memory usage: 1.6e+03Mb. #> --------------------------------------------------------- #>  #> --------------------------------------------------------- #> Inferring branch lengths of AncesTrees in sections 0-0... #> [0/0] CPU Time spent: 125.126487s; Max Memory usage: 1.6e+03Mb. #> --------------------------------------------------------- #>  #> --------------------------------------------------------- #> Combining AncesTrees in Sections... #> CPU Time spent: 126.740081s; Max Memory usage: 1.6e+03Mb. #> --------------------------------------------------------- #>  #> --------------------------------------------------------- #> Finalizing... #> Number of not mapping SNPs: 414 #> Number of flipped SNPs    : 77 #> CPU Time spent: 129.342274s; Max Memory usage: 1.6e+03Mb. #> --------------------------------------------------------- #>  #> --------------------------------------------------------- #> Done. #> --------------------------------------------------------- #> *********************************************************"},{"path":"https://leospeidel.com/twigstats/articles/real-data-example.html","id":"running-twigstats","dir":"Articles","previous_headings":"","what":"Running Twigstats","title":"A small real data example","text":"Finally, inferred Relate trees, can now run Twigstats. aim infer admixture Anglo-Saxon individuals preceding British Iron/Roman Age Early Iron Age Scandinavia. illistrate power gain using Twigstats, run Twigstats two different ways: First, compute regular f2-statistics second, compute f2-statistics recent coalescences. first assign filenames variables. Next, compute regular f2 statistics without time cutoff: can see, inferred admixture proportion 0 1 standard errors extremely large, giving us meaningful inference. now compute f2 statistics lineages past 500 generations using Twigstats: standard errors much reduced get meaningful admixture proportion! Note standard error still relatively large (though excludes 0 1 feasible proportions). obvious way improve power use chromosomes; used chromosome 1. Additionally, build Relate trees samples get accurate contrains dates.","code":"library(twigstats) #> Loading required package: dplyr #>  #> Attaching package: 'dplyr' #> The following objects are masked from 'package:stats': #>  #>     filter, lag #> The following objects are masked from 'package:base': #>  #>     intersect, setdiff, setequal, union  file_anc  <- \"1000G_aDNA_mask_transv_chr1.anc.gz\" file_mut  <- \"1000G_aDNA_mask_transv_chr1.mut.gz\" poplabels <- system.file(\"example/1000GP_Phase3_sub_aDNA.poplabels\", package = \"twigstats\") file_map  <- system.file(\"example/genetic_map_combined_b37_chr1.txt\", package = \"twigstats\") #Calculate f2s between all pairs of populations f2_blocks <- f2_blocks_from_Relate(file_anc, file_mut, poplabels, file_map, use_muts = T) f4_ratio(f2_blocks, popX=\"England_Saxon.SG\", popI=\"Ireland_BA.SG\", pop1=\"Britain.IronRoman.SG\", pop2=\"Scandinavian_Peninsula_EIA(I).SG\", popO=\"YRI\") #>   popO          popI                 pop1                             pop2 #> 1  YRI Ireland_BA.SG Britain.IronRoman.SG Scandinavian_Peninsula_EIA(I).SG #>               popX      val       se #> 1 England_Saxon.SG 3.031811 60.95149 #Use a cutoff of 500 generations f2_blocks <- f2_blocks_from_Relate(file_anc, file_mut, poplabels, file_map, t = 500) f4_ratio(f2_blocks, popX=\"England_Saxon.SG\", popI=\"Ireland_BA.SG\", pop1=\"Britain.IronRoman.SG\", pop2=\"Scandinavian_Peninsula_EIA(I).SG\", popO=\"YRI\") #>   popO          popI                 pop1                             pop2 #> 1  YRI Ireland_BA.SG Britain.IronRoman.SG Scandinavian_Peninsula_EIA(I).SG #>               popX       val        se #> 1 England_Saxon.SG 0.3812473 0.1750409"},{"path":"https://leospeidel.com/twigstats/authors.html","id":null,"dir":"","previous_headings":"","what":"Authors","title":"Authors and Citation","text":"Leo Speidel. Maintainer.","code":""},{"path":"https://leospeidel.com/twigstats/authors.html","id":"citation","dir":"","previous_headings":"","what":"Citation","title":"Authors and Citation","text":"Speidel L, Skoglund P (2024). “tbd.” tbd.","code":"@Article{,   title = {tbd},   author = {Leo Speidel and Pontus Skoglund},   journal = {tbd},   year = {2024}, }"},{"path":"https://leospeidel.com/twigstats/index.html","id":"twigstats-","dir":"","previous_headings":"","what":"twigstats ","title":"twigstats ","text":"Boost f-statitics power using genealogies. Compatible admixtools2. Full documentation leospeidel.com/twigstats. function described page: leospeidel.com/twigstats/reference.","code":""},{"path":"https://leospeidel.com/twigstats/index.html","id":"installation","dir":"","previous_headings":"","what":"Installation","title":"twigstats ","text":"Please install package running following command R: Alternatively, clone directory (https://github.com/leospeidel/twigstats) R type","code":"library(devtools) install_github(\"leospeidel/twigstats\") library(devtools) install()"},{"path":"https://leospeidel.com/twigstats/index.html","id":"basic-usage","dir":"","previous_headings":"","what":"Basic Usage","title":"twigstats ","text":"Please see leospeidel.com/twigstats/articles/basic-usage.html. small real data example see leospeidel.com/twigstats/articles/real-data-example.html.","code":""},{"path":"https://leospeidel.com/twigstats/reference/ExpPaintingProfile.html","id":null,"dir":"Reference","previous_headings":"","what":"Function to calculate first coalescence copying vector for each population specified in poplabels file. — ExpPaintingProfile","title":"Function to calculate first coalescence copying vector for each population specified in poplabels file. — ExpPaintingProfile","text":"function calculates proportion genome first coalescence group x. returns version coalescence group counted, one group excluded.","code":""},{"path":"https://leospeidel.com/twigstats/reference/ExpPaintingProfile.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Function to calculate first coalescence copying vector for each population specified in poplabels file. — ExpPaintingProfile","text":"","code":"ExpPaintingProfile(file_anc, file_mut, poplabels, pops = NULL, chrs = NULL)"},{"path":"https://leospeidel.com/twigstats/reference/ExpPaintingProfile.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Function to calculate first coalescence copying vector for each population specified in poplabels file. — ExpPaintingProfile","text":"file_anc Filename anc file. chrs specified, prefix, resulting filenames ${file_anc}_chr${chr}.anc(.gz). file_mut Filename mut file. chrs specified, prefix, resulting filenames ${file_anc}_chr${chr}.anc(.gz). poplabels Filename poplabels file pops (Optional) Populations data extracted. Names need match second column poplabels file chrs (Optional) Vector chromosome IDs","code":""},{"path":"https://leospeidel.com/twigstats/reference/ExpPaintingProfile.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Function to calculate first coalescence copying vector for each population specified in poplabels file. — ExpPaintingProfile","text":"2d array dimension #groups x #groups.","code":""},{"path":"https://leospeidel.com/twigstats/reference/ExpPaintingProfile.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Function to calculate first coalescence copying vector for each population specified in poplabels file. — ExpPaintingProfile","text":"","code":"file_anc  <- system.file(\"sim/msprime_ad0.8_split250_1_chr1.anc.gz\", package = \"twigstats\") file_mut  <- system.file(\"sim/msprime_ad0.8_split250_1_chr1.mut.gz\", package = \"twigstats\") poplabels <- system.file(\"sim/msprime_ad0.8_split250_1.poplabels\", package = \"twigstats\")  #Calculate f2s between all pairs of populations nn_res <- ExpPaintingProfile(file_anc, file_mut, poplabels) if(require(lsei)){   pnnls(t(nn_res[c(\"P2\",\"P3\"),c(\"P1\",\"P2\",\"P3\",\"P4\"),1]),(nn_res[\"PX\",c(\"P1\",\"P2\",\"P3\",\"P4\"),1]), sum = 1)$x }"},{"path":"https://leospeidel.com/twigstats/reference/Painting.html","id":null,"dir":"Reference","previous_headings":"","what":"Chromosome painting using genealogies. — Painting","title":"Chromosome painting using genealogies. — Painting","text":"function outputs first coalescence individual pre-specified group identity along genome. first coalescnece involves several copying candidates, random haplotype chosen. Output GLOBEtrotter format.","code":""},{"path":"https://leospeidel.com/twigstats/reference/Painting.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Chromosome painting using genealogies. — Painting","text":"","code":"Painting(   file_anc,   file_mut,   file_map,   file_out,   poplabels,   blgsize = NULL,   pops = NULL,   chrs = NULL )"},{"path":"https://leospeidel.com/twigstats/reference/Painting.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Chromosome painting using genealogies. — Painting","text":"file_anc Filename anc file. chrs specified, prefix, resulting filenames ${file_anc}_chr${chr}.anc(.gz). file_mut Filename mut file. chrs specified, prefix, resulting filenames ${file_anc}_chr${chr}.anc(.gz). file_map File prefix recombination map. file_out File prefix output files poplabels Filename poplabels file blgsize (Optional) SNP block size Morgan. Default 0.05 (50 cM). blgsize 100 greater, interpreted base pair distance rather centimorgan distance. pops (Optional) Populations data extracted. Names need match second column poplabels file chrs (Optional) Vector chromosome IDs","code":""},{"path":"https://leospeidel.com/twigstats/reference/Painting.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Chromosome painting using genealogies. — Painting","text":"void. Write three files idfile, paint, rec disc.","code":""},{"path":"https://leospeidel.com/twigstats/reference/Painting.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Chromosome painting using genealogies. — Painting","text":"","code":"file_anc  <- system.file(\"sim/msprime_ad0.8_split250_1_chr1.anc.gz\", package = \"twigstats\") file_mut  <- system.file(\"sim/msprime_ad0.8_split250_1_chr1.mut.gz\", package = \"twigstats\") poplabels <- system.file(\"sim/msprime_ad0.8_split250_1.poplabels\", package = \"twigstats\") file_map  <- system.file(\"sim/genetic_map_combined_b37_chr1.txt\", package = \"twigstats\")  #define populations to paint against: pops <- c(\"P1\",\"P2\",\"P3\",\"P4\")  Painting(file_anc, file_mut, file_map, file_out = \"test\", poplabels, blgsize = 1e-5)"},{"path":"https://leospeidel.com/twigstats/reference/PaintingNNLS.html","id":null,"dir":"Reference","previous_headings":"","what":"Function to run an NNLS on genome-wide copying proportions to estimate admixture proportions. — PaintingNNLS","title":"Function to run an NNLS on genome-wide copying proportions to estimate admixture proportions. — PaintingNNLS","text":"function computes admixture proprtions using non-negative least squares painting profiles obtained function PaintingProfile","code":""},{"path":"https://leospeidel.com/twigstats/reference/PaintingNNLS.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Function to run an NNLS on genome-wide copying proportions to estimate admixture proportions. — PaintingNNLS","text":"","code":"PaintingNNLS(df_sum, target_pops, source_pops = NULL)"},{"path":"https://leospeidel.com/twigstats/reference/PaintingNNLS.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Function to run an NNLS on genome-wide copying proportions to estimate admixture proportions. — PaintingNNLS","text":"df_sum Output PaintingProfile target_pops Vector populations fitted source_pops (Optional) Vector putative source populations. provided, remaining populations used.","code":""},{"path":"https://leospeidel.com/twigstats/reference/PaintingNNLS.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Function to run an NNLS on genome-wide copying proportions to estimate admixture proportions. — PaintingNNLS","text":"Returns data frame admixture proportions.","code":""},{"path":"https://leospeidel.com/twigstats/reference/PaintingNNLS.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Function to run an NNLS on genome-wide copying proportions to estimate admixture proportions. — PaintingNNLS","text":"","code":"library(dplyr)  #This path stores files precomputed using Painting(). path      <- paste0(system.file(\"test/\", package = \"twigstats\"),\"/\") prefix    <- \"test\" #prefix of files under path  #compute the painting profiles with 100 bootstrap samples and a blocksize of 5cM (5000*0.001) df <- PaintingProfile(c(paste0(path,prefix,\"_painting.txt.gz\")), paste0(path,prefix,\"_idfile.txt.gz\"), nboot = 100, blocksize = 5000)  #compute the NNLS to get admixture proportions df <- PaintingNNLS(df, target_pops = c(\"PX\"), source_pops = c(\"P2\",\"P3\"))  #Now you can summarize the bootstrap samples  df %>% group_by(target, POP) %>% summarize(mean_ancestry = mean(ancestry), sd_ancestry = sd(ancestry)) -> df print(df)"},{"path":"https://leospeidel.com/twigstats/reference/PaintingProfile.html","id":null,"dir":"Reference","previous_headings":"","what":"Function to compute genome-wide copying proportions. — PaintingProfile","title":"Function to compute genome-wide copying proportions. — PaintingProfile","text":"function takes output function Painting computes genome-wide 'copying vectors',  .e. proportion genome copied reference population..","code":""},{"path":"https://leospeidel.com/twigstats/reference/PaintingProfile.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Function to compute genome-wide copying proportions. — PaintingProfile","text":"","code":"PaintingProfile(filename_painting, filename_idfile, nboot, blocksize)"},{"path":"https://leospeidel.com/twigstats/reference/PaintingProfile.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Function to compute genome-wide copying proportions. — PaintingProfile","text":"filename_painting Vector containing filenames painting profiles. Output Painting. filename_idfile Filename idfile. Output Painting. nboot Number bootstrap samples. blocksize Number blocks combine bootstrap. E.g. Painting run blgsize 1e-5 Morgans, blocksize 5000 achieve blocksize 5cM.","code":""},{"path":"https://leospeidel.com/twigstats/reference/PaintingProfile.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Function to compute genome-wide copying proportions. — PaintingProfile","text":"Returns data frame copying proportions per bootstrap sample.","code":""},{"path":"https://leospeidel.com/twigstats/reference/PaintingProfile.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Function to compute genome-wide copying proportions. — PaintingProfile","text":"","code":"#This path stores files precomputed using Painting(). path      <- paste0(system.file(\"test/\", package = \"twigstats\"),\"/\") prefix    <- \"test\" #prefix of files under path  #compute the painting profiles with 10 bootstrap samples and a blocksize of 5cM (5000*0.001) df <- PaintingProfile(c(paste0(path,prefix,\"_painting.txt.gz\")), paste0(path,prefix,\"_idfile.txt.gz\"), nboot = 10, blocksize = 5000) head(df)"},{"path":"https://leospeidel.com/twigstats/reference/f-statistics.html","id":null,"dir":"Reference","previous_headings":"","what":"Function implementing the F4-ratio statistic — f4_ratio","title":"Function implementing the F4-ratio statistic — f4_ratio","text":"function computes admixture proportion given five populations. population history following ((PI,P1),P2,PO) assumed, target assumed mixture proximal sources P1 P2, .e. PX = alpha*P2 + (1-alpha)*P1 function implements jackknife input data.","code":""},{"path":"https://leospeidel.com/twigstats/reference/f-statistics.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Function implementing the F4-ratio statistic — f4_ratio","text":"","code":"f4_ratio(f2_blocks, popO, popI, pop1, pop2, popX)  jackknife(df_jack)"},{"path":"https://leospeidel.com/twigstats/reference/f-statistics.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Function implementing the F4-ratio statistic — f4_ratio","text":"f2_blocks 3d array blocked f2 statistics popO Name outgroup population popI Name ingroup population pop1 Name source clusters ingroup pop2 Name source popX Name target group. data frame. Three columns called blockID, hj, Dj, storing block ID, weight block, statistic without block","code":""},{"path":"https://leospeidel.com/twigstats/reference/f-statistics.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Function implementing the F4-ratio statistic — f4_ratio","text":"Returns data frame admixture proportion estimates jacknifed standard errors. Returns data table columns val se.","code":""},{"path":"https://leospeidel.com/twigstats/reference/f-statistics.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Function implementing the F4-ratio statistic — f4_ratio","text":"","code":"#These lines assign file names to variables file_anc, file_mut, poplabels, file_map. #see https://myersgroup.github.io/relate/getting_started.html#Output for file formats file_anc  <- system.file(\"sim/msprime_ad0.8_split250_1_chr1.anc.gz\", package = \"twigstats\") file_mut  <- system.file(\"sim/msprime_ad0.8_split250_1_chr1.mut.gz\", package = \"twigstats\") #see https://myersgroup.github.io/relate/input_data.html for file formats poplabels <- system.file(\"sim/msprime_ad0.8_split250_1.poplabels\", package = \"twigstats\") file_map  <- system.file(\"sim/genetic_map_combined_b37_chr1.txt\", package = \"twigstats\") #recombination map (three column format)  #Calculate regular f2s between all pairs of populations f2_blocks1 <- f2_blocks_from_Relate(file_anc, file_mut, poplabels, file_map) f4_ratio(f2_blocks1, popX=\"PX\", popI=\"P1\", pop1=\"P2\", pop2=\"P3\", popO=\"P4\")  #Use a twigstats cutoff of 500 generations f2_blocks2 <- f2_blocks_from_Relate(file_anc, file_mut, poplabels, file_map, t = 500) f4_ratio(f2_blocks2, popX=\"PX\", popI=\"P1\", pop1=\"P2\", pop2=\"P3\", popO=\"P4\")"},{"path":"https://leospeidel.com/twigstats/reference/f2_blocks_from_Relate.html","id":null,"dir":"Reference","previous_headings":"","what":"Function to calculate f2 statistics from Relate trees for pairs of populations specified in poplabels. — f2_blocks_from_Relate","title":"Function to calculate f2 statistics from Relate trees for pairs of populations specified in poplabels. — f2_blocks_from_Relate","text":"function calculate f2 statistics blocks prespecified size pairs populations specified poplabels file. Please refer Relate documentation input file formats (https://myersgroup.github.io/relate/). output format directly accepted admixtools R package calculate  f3, f4, f4ratio, D statistics (https://uqrmaie1.github.io/admixtools/).","code":""},{"path":"https://leospeidel.com/twigstats/reference/f2_blocks_from_Relate.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Function to calculate f2 statistics from Relate trees for pairs of populations specified in poplabels. — f2_blocks_from_Relate","text":"","code":"f2_blocks_from_Relate(   file_anc,   file_mut,   poplabels,   file_map = NULL,   chrs = NULL,   blgsize = NULL,   mu = NULL,   tmin = NULL,   t = NULL,   transitions = NULL,   use_muts = NULL,   minMAF = NULL,   dump_blockpos = NULL,   apply_corr = NULL )"},{"path":"https://leospeidel.com/twigstats/reference/f2_blocks_from_Relate.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Function to calculate f2 statistics from Relate trees for pairs of populations specified in poplabels. — f2_blocks_from_Relate","text":"file_anc Filename anc file. chrs specified, prefix, resulting filenames ${file_anc}_chr${chr}.anc(.gz). file_mut Filename mut file. chrs specified, prefix, resulting filenames ${file_anc}_chr${chr}.anc(.gz). poplabels Filename poplabels file file_map (Optional) File prefix recombination map. needed blgsize given base-pairs, .e. blgsize > 100 chrs (Optional) Vector chromosome IDs blgsize (Optional) SNP block size Morgan. Default 0.05 (50 cM). blgsize 100 greater, interpreted base pair distance rather centimorgan distance. mu (Optional) Per base per generation mutation rate scale f2 values. Default: 1.25e-8 tmin (Optional) Minimum time cutof generations. lineages younger tmin excluded analysis. Default: t = 0. t (Optional) Time cutoff generations. Default: Inf transitions (Optional) Set FALSE exclude transition SNPs. meaningful use_muts use_muts (Optional) Calculate traditional f2 statistics using mutations mapped Relate trees. Default: false. minMAF (Optional) Minimum frequency cutoff. Default: 1 (.e. excl singletons) dump_blockpos (Optional) Filename blockpos file. apply_corr (Optional) Use small sample size correction. Default: true.","code":""},{"path":"https://leospeidel.com/twigstats/reference/f2_blocks_from_Relate.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Function to calculate f2 statistics from Relate trees for pairs of populations specified in poplabels. — f2_blocks_from_Relate","text":"3d array dimension #groups x #groups x #blocks. Analogous output f2_from_geno admixtools.","code":""},{"path":"https://leospeidel.com/twigstats/reference/f2_blocks_from_Relate.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Function to calculate f2 statistics from Relate trees for pairs of populations specified in poplabels. — f2_blocks_from_Relate","text":"","code":"file_anc  <- system.file(\"sim/msprime_ad0.8_split250_1_chr1.anc.gz\", package = \"twigstats\") file_mut  <- system.file(\"sim/msprime_ad0.8_split250_1_chr1.mut.gz\", package = \"twigstats\") poplabels <- system.file(\"sim/msprime_ad0.8_split250_1.poplabels\", package = \"twigstats\") file_map  <- system.file(\"sim/genetic_map_combined_b37_chr1.txt\", package = \"twigstats\")  #Calculate f2s between all pairs of populations f2_blocks <- f2_blocks_from_Relate(file_anc, file_mut, poplabels, file_map) f4_ratio(f2_blocks, popX=\"PX\", popI=\"P1\", pop1=\"P2\", pop2=\"P3\", popO=\"P4\")  #Use a cutoff of 500 generations f2_blocks <- f2_blocks_from_Relate(file_anc, file_mut, poplabels, file_map, t = 500) f4_ratio(f2_blocks, popX=\"PX\", popI=\"P1\", pop1=\"P2\", pop2=\"P3\", popO=\"P4\")"},{"path":"https://leospeidel.com/twigstats/reference/f2_blocks_from_RelateAges.html","id":null,"dir":"Reference","previous_headings":"","what":"Function to calculate f2 statistics from plink files, ascertained using mutation ages in Relate trees. — f2_blocks_from_RelateAges","title":"Function to calculate f2 statistics from plink files, ascertained using mutation ages in Relate trees. — f2_blocks_from_RelateAges","text":"function calculate f2 statistics blocks prespecified size pairs populations specified input files. Input assumed PLINK binary format https://www.cog-genomics.org/plink/1.9/formats#bed mutation ages Relate mut format https://myersgroup.github.io/relate/. output format directly accepted admixtools R package calculate  f2, f3, f4, f4ratio, D statistics (https://uqrmaie1.github.io/admixtools/).","code":""},{"path":"https://leospeidel.com/twigstats/reference/f2_blocks_from_RelateAges.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Function to calculate f2 statistics from plink files, ascertained using mutation ages in Relate trees. — f2_blocks_from_RelateAges","text":"","code":"f2_blocks_from_RelateAges(   pref,   file_mut,   blgsize = NULL,   transitions = NULL,   maxmiss = NULL,   fam = NULL,   pops = NULL,   chrs = NULL,   tmin = NULL,   t = NULL,   include_undated = NULL,   minMAF = NULL,   apply_corr = NULL,   debug_mode = 0L )"},{"path":"https://leospeidel.com/twigstats/reference/f2_blocks_from_RelateAges.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Function to calculate f2 statistics from plink files, ascertained using mutation ages in Relate trees. — f2_blocks_from_RelateAges","text":"pref Prefix PLINK binary files, assuming filenames form ${pref}.bed, ${pref}.bim, $pref.fam. file_mut (Optional) Prefix filenames mut files, assuming filenames form ${file_mut}_chr1.mut(.gz). Chromosome names consistent PLINK files. file specified, mutations PLINK file used. blgsize (Optional) SNP block size Morgan. Default 0.05 (50 cM). blgsize 100 greater, interpreted base pair distance rather centimorgan distance. transitions (Optional) Set FALSE exclude transition SNPs maxmiss (Optional) Discard SNPs missing fraction populations higher $B!F(Bmaxmiss fam (Optional) 1d-array assigning individuals populations. Corresponds first column fam file useful want change population assignments. pops (Optional) Populations data extracted. Names need match first column fam file (fam option ) chrs (Optional) List chromosome names use. tmin (Optional) Minimum time cutof generations. mutations younger tmin excluded analysis. Default: t = 0. t (Optional) Time cutoff generations. mutations older t excluded analysis. Default: t = Inf. include_undated (Optional) Include mutations dated. Default: false. minMAF (Optional) minimum minor allele count. Default: 1. apply_corr (Optional) Use small sample size correction. Default: true. debug_mode (Optional) Prints progress used debugging.","code":""},{"path":"https://leospeidel.com/twigstats/reference/f2_blocks_from_RelateAges.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Function to calculate f2 statistics from plink files, ascertained using mutation ages in Relate trees. — f2_blocks_from_RelateAges","text":"3d array dimension #groups x #groups x #blocks containing f2 statistics. Analogous output f2_from_geno admixtools.","code":""},{"path":"https://leospeidel.com/twigstats/reference/f2_blocks_from_RelateAges.html","id":"ref-examples","dir":"Reference","previous_headings":"","what":"Examples","title":"Function to calculate f2 statistics from plink files, ascertained using mutation ages in Relate trees. — f2_blocks_from_RelateAges","text":"","code":"path <- paste0(system.file(\"sim/\", package = \"twigstats\"),\"/\") pref <- \"msprime_ad0.8_split250_1\" file_plink <- paste0(path,pref) #only need prefix file_mut  <- paste0(path,pref) #only need prefix (here same name as plink file but can be different)  #Compute f2 statistics between all pairs of populations. You can use pops to only calculate f2s between specified populations. f2_blocks <- f2_blocks_from_RelateAges(pref = file_plink, file_mut) f4_ratio(f2_blocks, popX=\"PX\", popI=\"P1\", pop1=\"P2\", pop2=\"P3\", popO=\"P4\")  #Use a cutoff of 500 generations f2_blocks <- f2_blocks_from_RelateAges(pref = file_plink, file_mut, t = 500) f4_ratio(f2_blocks, popX=\"PX\", popI=\"P1\", pop1=\"P2\", pop2=\"P3\", popO=\"P4\")"},{"path":"https://leospeidel.com/twigstats/reference/f4_ratio.html","id":null,"dir":"Reference","previous_headings":"","what":"F4-ratio — f4_ratio","title":"F4-ratio — f4_ratio","text":"function computes admixture proportion given five populations. population history following ((PI,P1),P2,PO) assumed, target assumed mixture proximal sources P1 P2, .e. PX = alpha*P2 + (1-alpha)*P1","code":""},{"path":"https://leospeidel.com/twigstats/reference/f4_ratio.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"F4-ratio — f4_ratio","text":"","code":"f4_ratio(f2_blocks, popO, popI, pop1, pop2, popX)"},{"path":"https://leospeidel.com/twigstats/reference/f4_ratio.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"F4-ratio — f4_ratio","text":"f2_blocks. 3d array blocked f2 statistics popO. Name outgroup population popI. Name ingroup population pop1. Name source clusters ingroup pop2. Name source popX. Name target group.","code":""},{"path":"https://leospeidel.com/twigstats/reference/f4_ratio.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"F4-ratio — f4_ratio","text":"Returns data frame admixture proportion estimates jacknifed standard errors.","code":""},{"path":"https://leospeidel.com/twigstats/reference/jackknife.html","id":null,"dir":"Reference","previous_headings":"","what":"Jackknife — jackknife","title":"Jackknife — jackknife","text":"function implements jackknife input data.","code":""},{"path":"https://leospeidel.com/twigstats/reference/jackknife.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Jackknife — jackknife","text":"","code":"jackknife(df_jack)"},{"path":"https://leospeidel.com/twigstats/reference/jackknife.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Jackknife — jackknife","text":"data frame. Three columns called blockID, hj, Dj, storing block ID, weight block, statistic without block","code":""},{"path":"https://leospeidel.com/twigstats/reference/jackknife.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Jackknife — jackknife","text":"Returns data table columns val se.","code":""},{"path":"https://leospeidel.com/twigstats/reference/theoretical_zscore.html","id":null,"dir":"Reference","previous_headings":"","what":"Function to compute a theoretical z-score given source split times and admixture proportions. — theoretical_zscore","title":"Function to compute a theoretical z-score given source split times and admixture proportions. — theoretical_zscore","text":"function computes theoretical z-score f4-statistic form f4(PO,P2,PX,P1)  function admixture time , source (P1 & P2) split time s, admixture proportion alpha.  assumes single lineage sampled population.","code":""},{"path":"https://leospeidel.com/twigstats/reference/theoretical_zscore.html","id":"ref-usage","dir":"Reference","previous_headings":"","what":"Usage","title":"Function to compute a theoretical z-score given source split times and admixture proportions. — theoretical_zscore","text":"","code":"theoretical_zscore(t, a, s, alpha)"},{"path":"https://leospeidel.com/twigstats/reference/theoretical_zscore.html","id":"arguments","dir":"Reference","previous_headings":"","what":"Arguments","title":"Function to compute a theoretical z-score given source split times and admixture proportions. — theoretical_zscore","text":"t Twigstats cutoff time units 2Ne generations Admixture time units 2Ne generations s Source split time units 2Ne generations alpha Admixture proportions. Proportion P2 PX.","code":""},{"path":"https://leospeidel.com/twigstats/reference/theoretical_zscore.html","id":"value","dir":"Reference","previous_headings":"","what":"Value","title":"Function to compute a theoretical z-score given source split times and admixture proportions. — theoretical_zscore","text":"Returns theoretical z-score value.","code":""}]
